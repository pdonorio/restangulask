
rethinkdb:
  # image: pdonorio/rethinkdb:alpine
  image: rethinkdb:2.3.5
  hostname: rdbmaster
  volumes:
      - restangulask_rdbdata:/data

searchindex:
  image: elasticsearch:2.4
  # image: elasticsearch:5.0.0
  hostname: elastic
  environment:
      # curl http://el:9200/_nodes/process?pretty
      # http://stackoverflow.com/a/18152957/2114395
      #https://www.loggly.com/blog/nine-tips-configuring-elasticsearch-for-high-performance/
      # ES_HEAP_SIZE: 2g #deprecated in 5.0
      ES_HEAP_SIZE: 2500m #deprecated in 5.0
      # ES_JAVA_OPTS: "-Xms2g -Xmx2g" #this one works in 5.0
  volumes:
      - restangulask_elasticdata:/usr/share/elasticsearch/data
      - ../containers/elastic.confs:/usr/share/elasticsearch/config

uploadsdata:
  image: busybox
  command: echo 'launched'
  volumes:
    # Upload directory
    - ../uploads:/uploads

custombe:
  extends:
    file: docker-compose.yml
    service: backend
  environment:
    PYTHONIOENCODING: UTF-8
    DEVOP: python3.6 operations.py
    # DEVOP: PYTHONIOENCODING=UTF-8 python3.6 operations.py
  links:
    - rethinkdb:rdb
    - searchindex:el
  volumes_from:
    - uploadsdata

customfe:
  extends:
    file: docker-compose.yml
    service: frontend
  links:
    - custombe:myapi
  volumes_from:
    - htmlfiles
    - uploadsdata
