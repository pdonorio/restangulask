
<div ng-controller="FastSearchController as search"
    style="background-color: #fff;">

<!-- TOOLBAR -->
<form ng-submit="$event.preventDefault()"
    layout="row" layout-fill layout-wrap layout-padding layout-align="center center">
 <div flex layout="column">

 <md-toolbar class="white black-text" layout="row" layout-padding flex>
    <div flex="20"></div>

      <md-autocomplete
          md-min-length="1"
          md-input-id="autoCompleteId"
          md-search-text="search.searchText"
          md-search-text-change="search.searchTextChange(search.searchText)"
          md-selected-item="search.selectedItem"
          md-selected-item-change="search.selectedItemChange(item._source.suggest)"
          md-items="item in search.querySearch(search.searchText)"
          md-item-text="item._source.suggest"
          md-menu-class="autocomplete-custom-template"
          md-delay="400"
          md-select-on-match="true"
          md-match-case-insensitive="true"
          placeholder="Recherche"
          md-require-match="false"
          flex="40"
          >
        <md-item-template>
          <span layout="row" layout-align="start center">
            <!-- TYPE -->
            <span style="min-width: 250px;">
             <span ng-switch on="item._source.extra.cleanlabel">
              <i ng-switch-when="extrait" class="material-icons"> import_contacts </i>
              <i ng-switch-when="transcription" class="material-icons"> library_books </i>
              <i ng-switch-when="traduction" class="material-icons"> bookmark_border </i>
              <i ng-switch-default class="material-icons"> book </i>
             </span>
             &nbsp; <strong>{{item._source.label}}</strong>
            </span>
            <!-- VALUE -->
            <span
                md-highlight-text="search.searchText"
                md-highlight-flags="i"
                >{{item._source.suggest}}</span>
          </span>
        </md-item-template>
      </md-autocomplete>

      <span ng-if="advancedIsActivated && !advanced"
        style="color: red; font-size: 12px;">
        <!--
        warning: advanced filters activated
        TO FIX -->
        avertissement: filtres avancés activés
      </span>

      <div ng-if="!search.load && search.elements >= 0"
        flex="10"
        style="font-size: 14px;" >
            <!-- Trouvés -->
            <b>{{search.elements}}</b>
            <br>
            éléments
      </div>
      <div flex="20">
        <a layout="row" layout-align="center center"
          style="font-size: 14px;"
          href ng-click="advancing()">
            Recherche Avancée
            <i class="material-icons" ng-if="!advanced">add</i>
            <i class="material-icons" ng-if="advanced">remove</i>
        </a>
      </div>
      <div flex="10" ng-if="lexique_close">
        <a layout="row" layout-align="center center"
          style="font-size: 14px;"
          href ng-click="toggle('open')">
            Lexique
            <i class="material-icons">help</i>
        </a>
      </div>

 </md-toolbar>

<div layout="column">
    <md-card ng-if="advanced">
        <md-card-content class="nospaces">

<div ng-if="search.advancedLoader"
    ng-include="root.templateDir + 'loader.html'"></div>
<div ng-if="!search.advancedLoader" layout="row"
    class="smaller-margin">

<div layout="column"
    style="margin-left: 25px; padding-right: 25px; padding-top: 10px;"
    flex
    >

  <md-input-container>
    <label>Lieux</label>
    <md-select ng-model="search.filters.lieu" md-on-close="search.searchTextChange()" >
      <md-optgroup label="Lieux">
        <md-option ng-value="">-</md-option>
        <md-option ng-value="item" ng-repeat="item in ::search.base.lieus" >{{item}}</md-option>
      </md-optgroup>
    </md-select>
  </md-input-container>

  <md-input-container>
    <label>Support</label>
    <md-select ng-model="search.filters.manuscrit" md-on-close="search.searchTextChange()" >
      <md-optgroup label="Support">
        <md-option ng-value="">-</md-option>
        <md-option ng-value="item" ng-repeat="item in ::search.base.manuscrits" >{{item}}</md-option>
      </md-optgroup>
    </md-select>
  </md-input-container>

  <md-input-container>
    <label>Langue</label>
    <md-select ng-model="search.filters.langue" md-on-close="search.searchTextChange()" >
      <md-optgroup label="langues">
        <md-option ng-value="">-</md-option>
        <md-option value="français">français</md-option>
        <md-option value="latin">latin</md-option>
        <md-option value="italien">italien</md-option>
      </md-optgroup>
    </md-select>
  </md-input-container>


  <div layout="row" layout-align="center center"
    style="padding-top: 10px;">
      <label for="inputs" style="padding-right: 20px;"> Date </label>
      De
      <md-input-container style="margin: 0px;">
        <!-- <label>De</label> -->
        <input type="text" ng-model="search.filters.start_date"
            ng-blur="search.searchTextChange()" placeholder='jj-mm-aaaa' size="13">
      </md-input-container>
      À
      <md-input-container style="margin: 0px;">
        <!-- <label>À</label> -->
        <input type="text" ng-model="search.filters.end_date"
            ng-blur="search.searchTextChange()" placeholder='jj-mm-aaaa' size="13">
      </md-input-container>
  </div>

</div>
<div layout="column"
    style="padding-right: 25px; padding-top: 10px;"
    flex=50>

  <md-input-container>
    <label>Temps</label>
    <md-select ng-model="search.filters.temps" md-on-close="search.searchTextChange()" >
      <md-optgroup label="temps">
        <md-option ng-value="">-</md-option>
        <md-option ng-value="item" ng-repeat="item in ::search.base.temps" >{{item}}</md-option>
      </md-optgroup>
    </md-select>
  </md-input-container>

  <md-input-container>
    <label>Actions</label>
    <md-select ng-model="search.filters.actions" md-on-close="search.searchTextChange()" >
      <md-optgroup label="actions">
        <md-option ng-value="">-</md-option>
        <md-option ng-value="item" ng-repeat="item in ::search.base.actions" >{{item}}</md-option>
      </md-optgroup>
    </md-select>
  </md-input-container>

  <md-input-container>
    <label>Apparato</label>
    <md-select ng-model="search.filters.apparato" md-on-close="search.searchTextChange()" >
      <md-optgroup label="apparato">
        <md-option ng-value="">-</md-option>
        <md-option ng-value="item" ng-repeat="item in ::search.base.apparatos" >{{item}}</md-option>
      </md-optgroup>
    </md-select>
  </md-input-container>
  <div style="padding-top: 10px;">
    <input type="checkbox" id="cb"
        ng-model="search.filters.gravure"
        ng-change="search.searchTextChange()"
        />
    <label for="cb">Gravure</label>
  </div>

</div>
</div>
        </md-card-content>
        <div
            ng-if="!search.advancedLoader" style="margin: 0px;"
            class="md-actions" layout="row" layout-align="end end"
            >
            <!--
           <md-button ng-click="search.cloneDate()">clone date</md-button>
           -->

           <md-button ng-click="search.clearFilters()">
               Effacer
           </md-button>
         </div>
    </md-card>
</div>


<div>
    <div ng-if="search.load" ng-include="root.templateDir + 'loader.html'"></div>

<!--
    <span ng-if="!search.load && search.elements >= 0">
        <div ng-if="rows" class="md-whiteframe-6dp"
            layout="row" layout-padding layout-align="center center">
         <div>
            Lexique:
         </div>
         <div>
          <table class="striped">
            <thead>
                <tr>
                    <th ng-repeat="field in fields"> {{field}} </th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="row in rows">
                  <td ng-repeat="field in fields">
                    <span ng-if="row._source[field]"> {{row._source[field]}} </span>
                    <span ng-if="!row._source[field]"> - </span>
                  </td>
                </tr>
            </tbody>
          </table>
         </div>
        </div>
    </span>
-->

</div>

 </div>
</form>
<!-- TOOLBAR -->

<md-content
    class="virtualRepeatInfiniteScroll"
    flex id="inf-wrapper"
    layout="row" layout-padding layout-align="center center"
    >
    <div flex="10"></div>
    <div flex="auto">

<md-virtual-repeat-container
    ng-hide="search.extraits.hold"
    id="vertical-container">

<!--
  <h5>Resultats de la recherche:</h5>
-->

  <md-list class="activity-feed"
    md-virtual-repeat="item in search.extraits"
    md-on-demand
    class="repeated-item" flex>

    <md-list-item>

        <md-card
        style="width: 80px; height: 130px;"
            >
         <a ui-sref='logged.details({id: item._id, query:search.searchText})'>
          <div ng-if='!item._source.doc.thumbnail' class="searchthumb" >
            <!-- PLACEHOLDER
            ng-style="{'background-image':'url(placehold.it/110x160)'}"
            -->
            </div>
          <div ng-if='item._source.doc.thumbnail'
            style="background-size: 80px 130px;"

            class="searchthumb"
            ng-style="{'background-image':'url('+ item._source.doc.thumbnail +')'}"></div>
         </a>
        </md-card>

        <md-card class="nobox" style="width: 300px;" ng-if="item._source">
         <md-card-content class="minextrait"
            layout="column" layout-align="center center">

          <table class="nospaces bordered">
            <tr>
             <th> ID </th>
             <td> <span
                md-highlight-text="search.searchText" md-highlight-flags="i">
                {{item._source.extrait}}
                </span>
             </td>
            </tr> <tr>
             <th> Page </th>
             <td> {{item._source.page}} </td>
            </tr>
          </table>
         </md-card-content>
        </md-card>

        <md-card ng-if="item._source" style="width: 500px;">
         <md-card-content>
          <p>
            <i>Source</i>:
            <span md-highlight-text="search.searchText"
                md-highlight-flags="i">{{item._source.source}}</span>
            <br> <i>Fête</i>:
            <span md-highlight-text="search.searchText"
                md-highlight-flags="i">{{item._source.fete}}</span>
            <br> <i>Lieu</i>:
            <span md-highlight-text="search.searchText"
                md-highlight-flags="i">{{item._source.lieu}}</span>
            <span ng-if="item._source.date">
                <br> <i>Date</i>: {{item._source.date}}
            </span>
            <br>
          </p>
         </md-card-content>
        </md-card>

    </md-list-item>
  </md-list>
</md-virtual-repeat-container>


    </div>
</md-content>


 <section layout="row" >
   <md-sidenav class="md-sidenav-right" md-component-id="left"
          style="overflow-y: hidden; width: 410px;"
          md-is-open="lexiquesn" md-disable-backdrop md-whiteframe="4" >

      <md-content flex>
       <md-toolbar  layout="column" class="blue-grey">
        <h1 class="md-toolbar-tools">
            <div flex="90">
                Lexique indéx
            </div>
            <div flex="10" style="text-align: right;">
                <a href ng-click="toggle('close')">
                  <i class="material-icons">close</i>
                </a>
            </div>
        </h1>
       </md-toolbar>
       <div layout="row" layout-padding layout="center center">
           <md-input-container flex=40>
              <label>Lexique</label>
              <input type="text"
                ng-model="search.lexvar" ng-change="findLex()"
                ng-focus="search.catvar = ''; findLex()"
                    focus-on="focusMe"/>
           </md-input-container>
           <div flex=10></div>
           <md-input-container flex=40>
              <label>Catégorie</label>
              <input type="text"
                ng-model="search.catvar" ng-change="findLex()"
                ng-focus="search.lexvar = ''"/>
           </md-input-container>
       </div>
      </md-content>

      <md-content layout-padding
        style="overflow-y: scroll; height: 100%; width: 350px;">
          <md-list class="md-dense" flex>

    <div ng-if="lexlen == 0">
        -
    </div>

    <div >
    <!--
        <div ng-if="lexlen === null">
            loading...
        </div>
    -->

        <div ng-repeat="lex in lexers">
            <md-list-item class="md-3-line">
              <div class="md-list-item-text" layout="column">
                <h3>
                <!--titre:-->
                  <b>
                    <a href
                        ng-repeat="single in splitter(lex._source.titre)"
                        ng-click="search.searchText = single">
                        {{single}}
                    </a>
                  </b>
                </h3>
                <h4 ng-if="lex._source['français']">
                    français:
                    <a href
                        ng-repeat="single in splitter(lex._source['français'])"
                        ng-click="search.searchText = single">
                        {{single}}
                    </a>
                </h4>
                <h4 ng-if="lex._source.latin">
                    latin:
                    <a href
                        ng-repeat="single in splitter(lex._source.latin)"
                        ng-click="search.searchText = single">
                        {{single}}
                    </a>
                </h4>
                <h4 ng-if="lex._source.italien">
                    italien:
                    <a href
                        ng-repeat="single in splitter(lex._source.italien)"
                        ng-click="search.searchText = single">
                        {{single}}
                    </a>
                </h4>
                <br>
                <h4>
                 <i>
                  <span>
                    <a href ng-click="search.lexvar = ''; search.catvar = lex._source.sheet; findLex()">
                        {{lex._source.sheet}}
                    </a>
                  </span>

                  <span ng-if="lex._source.macro != '-'">
                    &gt;
                    <a href ng-click="search.lexvar = ''; search.catvar = lex._source.macro; findLex()">
                        {{lex._source.macro}}
                    </a>
                  </span>

                  <span ng-if="lex._source.macro != '-'">
                    &gt;
                    <a href ng-click="search.lexvar = ''; search.catvar = lex._source.micro; findLex()">
                        {{lex._source.micro}}
                    </a>
                  </span>
                 </i>
                </h4>
                <br>
              </div>
            </md-list-item>

            <md-divider ></md-divider>
            <br>

        </div>
    </div>

          </md-list>
      </md-content>
    </md-sidenav>

</section>

</div>