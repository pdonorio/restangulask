
<div ng-controller="FastSearchController as search"
    style="background-color: #fff;">

<!-- TOOLBAR -->
<form ng-submit="$event.preventDefault()"
    layout="row" layout-fill layout-wrap layout-padding layout-align="center center">
 <div flex="70" layout="column">
 <h4> Resultats de la <i>Recherche</i> </h4>
 <md-toolbar class="white black-text"
    layout="row" layout-padding flex >
      <md-autocomplete md-autofocus flex
          md-min-length="1"

          md-search-text="search.searchText"
          md-search-text-change="search.searchTextChange(search.searchText)"

          md-selected-item="search.selectedItem"
          md-selected-item-change="search.selectedItemChange(item._source.suggest)"
          md-items="item in search.querySearch(search.searchText)"
          md-item-text="item._source.suggest"

          md-menu-class="autocomplete-custom-template"
          md-delay="500"
          md-select-on-match="false"
          placeholder="Recherche" >
        <md-item-template>
          <span layout="row" layout-align="start center">
            <!-- TYPE -->
            <span style="width: 200px;">
                <span ng-switch on="item._source.label">
                  <i ng-switch-when="extrait"
                    class="material-icons"> import_contacts </i>
                  <i ng-switch-when="source"
                    class="material-icons"> book </i>
                  <i ng-switch-when="fete"
                    class="material-icons"> bookmark_border </i>
                  <i ng-switch-when="transcription"
                    class="material-icons"> library_books </i>
                </span>
                  &nbsp; <strong>{{item._source.label}}</strong>
            </span>
            <!-- VALUE -->
            <span
                md-highlight-text="search.searchText"
                md-highlight-flags="^i"
                >{{item._source.suggest}}</span>
          </span>
        </md-item-template>
        <!--
        <md-not-found> No matches... </md-not-found>
        -->
      </md-autocomplete>
    <a layout="row" layout-align="center center"
      style="font-size: 14px;"
      href ng-click="advanced = !advanced">
        <i class="material-icons" ng-if="!advanced">add</i>
        <i class="material-icons" ng-if="advanced">remove</i>
        Advanced Search
    </a>
 </md-toolbar>
 <span ng-if="search.elements >= 0">
    <b><i>Trouvés: {{search.elements}} éléments</i></b>
 </span>

<div layout="column" layout-padding>
    <md-card ng-if="advanced">
        <md-card-content> Filters:

<div layout=column>
  <md-input-container>
    <label>Fete</label>
    <md-select ng-model="search.filters.fete"
        md-on-close="search.searchTextChange()" >
      <md-optgroup label="fetes">
        <md-option ng-value="item" ng-repeat="item in search.fetes"
            >{{item}}</md-option>
      </md-optgroup>
    </md-select>
  </md-input-container>

<!--
<div>
    Select 2
</div>
-->

            </div>
        </md-card-content>
    </md-card>
</div>

 </div>
</form>
<!-- TOOLBAR -->


<md-content layout="row" layout-padding>
 <div flex='5'>&nbsp;</div>
 <div flex='95' ui-scroll-viewport style=" height: 700px; ">

 <table class='highlight'>
  <thead ng-if="search.elements > 0" >
    <tr>
        <th>Vignette</th>
        <th>Extrait</th>
        <th>Détails</th>
        <th><i>links</i></th>
    </tr>
  </thead>

  <tbody>
    <tr ui-scroll="row in datasource" adapter="myadapter">
<!--
    ng-repeat='row in search.data'>
-->
      <td>

        <div ng-if='!row._source.thumbnail'
            style=" background-repeat: no-repeat; background-size: 100% 100%;
                width: 110px; height: 160px;"
            ng-style="{'background-image':'url(http://placehold.it/110x160)'}"
        ></div>
        <div ng-if='row._source.thumbnail'
            style=" background-repeat: no-repeat; background-size: 100% 100%;
                width: 110px; height: 160px;"
            ng-style="{'background-image':'url('+ row._source.thumbnail +')'}"
        ></div>
      </td>
      <!-- <td> {{row._source}} </td> -->
      <td>
            <strong>
              <span
                md-highlight-text="search.searchText"
                md-highlight-flags="^i">{{row._source.extrait}}</span>
            </strong> </td>
      <td>
        <i>Source</i>:
        <span md-highlight-text="search.searchText"
            md-highlight-flags="^i">{{row._source.source}}</span>
        <br>
        <i>Fete</i>:
        <span md-highlight-text="search.searchText"
            md-highlight-flags="^i">{{row._source.fete}}</span>
        <br>
        <i>Lieu</i>:
        {{row._source.place}}
        <br>
        <i>Date</i>:
        {{row._source.date}}
        <br>
      </td>
      <td>
          <a ui-sref='public.details({id: row._id, query:search.searchText})'
              class="waves-effect waves-light btn-floating lime lighten-3">
              <i class="material-icons blue-grey-text">web</i>
          </a>
      </td>
    </tr>
  </tbody>
 </table>
 </div>
 </md-content>

</div>
